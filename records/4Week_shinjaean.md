## 미션 요구사항 분석 & 체크리스트

---

**[필수미션]**
-[x] 네이버클라우드플랫폼을 통한 배포, 도메인, HTTPS 까지 적용

-[x] 내가 받은 호감리스트(/usr/likeablePerson/toList)에서 성별 필터링기능 구현

**[선택미션]**
-[ ] 젠킨스를 통해서 리포지터리의 main 브랜치에 커밋 이벤트가 발생하면 자동으로 배포가 진행되도록

-[x] 내가 받은 호감리스트(/usr/likeablePerson/toList)에서 호감사유 필터링기능 구현

-[x] 내가 받은 호감리스트(/usr/likeablePerson/toList)에서 정렬기능
## 4주차 미션 요약

---

### 호감 리스트 성별 필터링

**[접근 방법]**

- 호감리스트(/usr/likeablePerson/toList) 페이지에서 GET 방식으로 전달되는 `gender` 데이터를 컨트롤러에서 사용하기 위해, 액션 메서드에 파라미터를 추가 

- 현제 세션에 로그인된 사용자(인스타 연동이 되어 있어야 함)가 받은 호감 표시 목록을 전부 가져온다.

- 컨트롤러에서 전달받는 `gender` 데이터가 'null'이 아닐 때, 사용자가 받은 호감 표시 목록은 필터링 되어야 한다.

- stream 객체의 filter 메소드를 사용하기 위해 사용자가 받은 호감 표시 목록을 가져올 때 데이터를 stream 으로 생성한다.

- filter 메소드를 통해 좋아요를 표시한 사람의 성별이 `gender`와 같은 호감 데이터만 남긴다.

- 최종적으로 필터링 된 데이터를 List 형태로 변환 후, Model 객체를 통해 "/usr/likeablePerson/toList"로 전달한다.

- **++추가++** 페이지 초기 상태에서는 `gender`가 'null' 데이터를 반환하지만, 항목을 선택한 후 다시 '전체'를 선택하면, 비어있는 문자열("")을 반환하게 되므로, 비어있는 문자열에 대해서도 처리가 가능하도록 구현했다.

### 호감 리스트 호감 사유 필터링

- 호감리스트(/usr/likeablePerson/toList) 페이지에서 GET 방식으로 전달되는 `attractiveTypeCode` 데이터를 컨트롤러에서 사용하기 위해, 액션 메서드에 파라미터를 추가

- 컨트롤러에서 전달받는 `attractiveTypeCode` 데이터가 "0"이 아닐 때, 사용자가 받은 호감 표시 목록은 필터링 되어야 한다.

- 이전 성별 필터링을 위해 생성한 stream 객체를 통해(filter 메소드 사용) 호감 데이터 중 `attractiveTypeCode`(클라이언트를 통해 전달 받은 인자 데이터와 LikeablePerson 객체 데이터가 가지고 있는 attractiveTypeCode를 비교)가 일치하는 데이터만 필터링한다.

- 최종적으로 성별 필터링과 호감 사유 필터링을 거친 데이터를 Model 객체를 통해 "/usr/likeablePerson/toList"로 전달

### 호감 리스트 정렬 기능
- 'NotProd.java' 파일에서 좋아요를 생성하고, 생성 날짜를 수정
  - Ut.reflection.setFieldValue 메소드 수정
    
    => LikeablePerson 클래스가 상속 받은 BaseEntity 클래스의 필드 데이터도 수정이 가능하도록 수정 작업을 진행 
- 호감리스트(/usr/likeablePerson/toList) 페이지에서 GET 방식으로 전달되는 `sortCode` 데이터를 컨트롤러에서 사용하기 위해, 액션 메서드에 파라미터를 추가
- 컨틀롤러가 전달받은 `sortCode` 데이터가 '1' 이면 '최신순' 정렬 '2' 이면 '날짜순' 정렬, '3' 이면 '인기 많은 순' 정렬, '4' 이면 '인기 적은 순' 정렬, '5' 이면 '성별순' 정렬, '6' 이면 '호감사유순' 정렬
- '1' 인 경우
  - 데이터를 가져오는 순간부터 createDate 기준 내림차순. 즉, '최신순'으로 정렬되지만, 혹시 몰라 한 번 더 정렬해주는 작업을 진행. Stream.sorted() 메소드는 기본적으로 오름차순 정렬이기 때문에, Comparator.comparing() 메소드를 통해 Comparator 객체를 생성할 때, reversed() 메소드를 사용하여 내림차순 정렬될 수 있도록 구현했다.
- '2' 인 경우
  - 위 작업에서 reversed() 메소드를 제거하면 오름차순 정렬. 즉, 데이터가 '오래된 순'으로 정렬된다.
- '3' 인 경우
  - 정렬 테스트를 위한 'NotProd.java' 파일에서 좋아요를 생성. 인기순 insta_user3(오늘 날짜 기준으로 3일 전 생성된 호감) > insta_user4(오늘 날짜 기준으로 2일 전 생성된 호감) > insta_user2(오늘 날짜 기준으로 4일 전 생성된 호감) > insta_user5(오늘 날짜 기준으로 1일 전 생성된 호감)'
  - LikeablePerson 객체에서 나에게 호감 표시한 인스타 멤버(fromInstaMember)가 호감 표시 받은 수(InstaMemberBase::getLikes 메소드를 통해 추출)를 기준으로 내림차순 정렬되도록 구현했다.
- '4' 인 경우
  - 위 작업에서 reversed() 메소드를 제거하면 호감 표시 받은 수를 기준으로 오름차순 정렬된다.
- '5' 인 경우
  - Comparator 객체를 생성. 두 객체의 `gender`를 비교했을 때, 같으면 '0'을, "W"면 '-1'을, 둘 다 아니면("M"이면) 1을 반환하도록 구현
  - 앞의 Comparator 객체의 기준대로 '-1'을 갖는 데이터(`gender` 가 "W")가 제일 앞쪽에 위치하고, '0'인 데이터("W"일 수도, "M"일 수도 있음)가 중간에, '1'인 데이터가 마지막 부분에 위치하게 된다.
  - 마지막으로 thenComparing() 메소드를 사용하여, 성별순으로 정렬되고, 성별이 같은 데이터들은 최신순으로 정렬되도록 구현했다.
- '6' 인 경우
  - 각 호감 사유 별 코드가, 외모: 1, 성격: 2, 능력: 3 이므로, `attractiveTypeCode` 데이터를 기준으로 오름차순 정렬되도록 구현. 호감 사유가 같은 데이터들은 최신순으로 정렬되도록 구현했다.  

**[특이사항]**

- Jenkins를 통한 자동 배포

  => 자동 배포까지 되도록 작업하지 못 했다.

  => jenkins와 Git hub repository를 ssh 로 연결하고, repo 에서 commit 이 발생하면, 자동으로 jenkins 가 pull 받아오는 것 까지는 완료

## 4주차 미션 제출 이후

### 자잘한 리팩토링

- showToList() 메소드의 파라미터 중 `gender`에 @RequestParam(defaultValue = "") 어노테이션 추가. 디폴트 값으로 빈 문자열("")을 받도록 설정

  => `gender`가 null 인지 체크하지 않아도 됨. 값이 비어있지 않을 때에만 로직을 실행하도록 구현

- `createDate` 데이터를 비교하는 게 아닌, `id` 데이터를 비교하도록 수정

- switch 문, 중복 제거

- 가독성을 높이기 위한 변수명 구체화